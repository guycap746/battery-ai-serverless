<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Battery AI ‚Äì Smart Battery Analysis</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <!-- Include all your styles here -->
  <style>/* ... (CSS styles from your earlier post) ... */</style>
</head>
<body>
  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="logo">‚ö° Battery AI</div>
      <ul class="nav-links">
        <li><a href="#hero">Home</a></li>
        <li><a href="#features">Features</a></li>
        <li><a href="#upload">Analyze</a></li>
      </ul>
    </div>
  </nav>

  <!-- HERO SECTION -->
  <section class="hero" id="hero">
    <div class="hero-container">
      <div class="hero-content">
        <div class="badge">üöÄ Powered by AI</div>
        <h1>Smart <span class="highlight">Battery</span> Analysis</h1>
        <p>Upload an image of a battery and let AI identify its type, specs, and safety info.</p>
      </div>
      <div class="upload-card" id="upload">
        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
          <div class="upload-icon">üì∑</div>
          <div class="upload-text">Upload Battery Image</div>
          <div class="upload-hint">Click or drag to upload ‚Ä¢ JPG, PNG</div>
        </div>
        <input type="file" id="fileInput" class="file-input" accept="image/*" capture="environment" />
        <div class="preview-container" id="previewContainer">
          <img id="previewImage" class="preview-image" alt="Battery preview" />
          <div id="imageInfo" class="image-info" style="display: none;"></div>
        </div>
        <button class="analyze-btn" id="analyzeBtn" onclick="analyzeImage()" disabled>‚ö° Analyze Battery</button>
        <div class="loading" id="loading">
          <div class="loading-spinner"></div>
          <div class="loading-text">Analyzing with AI...</div>
        </div>
        <div class="results" id="results">
          <h3 class="results-header">Analysis Results</h3>
          <div id="resultsContent"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- FEATURES -->
  <section class="features" id="features">
    <div class="features-container">
      <h2>Powerful AI Features</h2>
      <p>Analyze lithium batteries using computer vision models and intelligent text parsing.</p>
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">üîã</div>
          <h3>Battery Detection</h3>
          <p>Identify whether the object is a battery and extract its basic type.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">üìä</div>
          <h3>Specs Extraction</h3>
          <p>AI tries to extract voltage, capacity, brand, model, and more from the label.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">üõ°Ô∏è</div>
          <h3>Safety Insights</h3>
          <p>Highlights battery condition or any warning signs visible in the image.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-badge">üîí Privacy-First ‚Ä¢ Serverless on Vercel + OpenAI</div>
  </footer>

  <!-- JS Logic -->
  <script>
    let currentImageData = null;
    document.getElementById('fileInput').addEventListener('change', handleFileSelect);
    const uploadArea = document.querySelector('.upload-area');
    uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
    uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
    uploadArea.addEventListener('drop', e => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
    });

    function handleFileSelect(e) {
      const file = e.target.files[0];
      if (file) handleFile(file);
    }

    function handleFile(file) {
      if (!file.type.startsWith('image/')) return alert('Invalid file type.');
      const reader = new FileReader();
      reader.onload = e => {
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          const maxSize = 1024;
          let { width, height } = img;
          const scale = Math.min(maxSize / width, maxSize / height, 1);
          width *= scale; height *= scale;
          canvas.width = width; canvas.height = height;
          ctx.drawImage(img, 0, 0, width, height);
          const dataUrl = canvas.toDataURL('image/jpeg', 0.85);
          currentImageData = dataUrl;
          document.getElementById('previewImage').src = dataUrl;
          document.getElementById('previewContainer').style.display = 'block';
          document.getElementById('imageInfo').style.display = 'block';
          document.getElementById('imageInfo').textContent = `üñºÔ∏è ${width}√ó${height}`;
          document.getElementById('analyzeBtn').disabled = false;
          document.getElementById('results').style.display = 'none';
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    async function analyzeImage() {
      if (!currentImageData) return alert('Upload an image first.');
      document.getElementById('loading').style.display = 'block';
      document.getElementById('analyzeBtn').disabled = true;
      try {
        const res = await fetch('/api/analyze-battery', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ image: currentImageData })
        });
        const data = await res.json();
        renderResults(data);
      } catch (e) {
        alert('Error analyzing battery.');
      } finally {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('analyzeBtn').disabled = false;
      }
    }

    function renderResults(data) {
      const results = document.getElementById('results');
      const resultsContent = document.getElementById('resultsContent');
      resultsContent.innerHTML = '';
      if (data.is_battery) {
        resultsContent.innerHTML = `
          <div class="battery-details is-battery">
            <h4>‚úÖ Battery Detected</h4>
            <p><strong>Type:</strong> ${data.object_type || 'Battery'}</p>
            ${data.battery_details?.voltage ? `<p><strong>Voltage:</strong> ${data.battery_details.voltage}</p>` : ''}
            ${data.battery_details?.capacity ? `<p><strong>Capacity:</strong> ${data.battery_details.capacity}</p>` : ''}
            ${data.battery_details?.brand ? `<p><strong>Brand:</strong> ${data.battery_details.brand}</p>` : ''}
            ${data.battery_details?.model ? `<p><strong>Model:</strong> ${data.battery_details.model}</p>` : ''}
          </div>`;
      } else {
        resultsContent.innerHTML = `
          <div class="battery-details not-battery">
            <h4>‚ùå Not a Battery</h4>
            <p><strong>Object:</strong> ${data.object_type || 'Unknown'}</p>
          </div>`;
      }
      results.style.display = 'block';
    }
  </script>
</body>
</html>
